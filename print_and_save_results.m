
duration_time = toc;


src1_max = max(max(Source1));
TRACK_noise = max(max(TRACK));
data_array = cell2mat(data);
date = datestr(now,30)
%error('stop')
if(debug_mode == 1)
    f5 = figure(5);

    hold on;
    subplot(3,1,1)
    hold on;
    length_line = length(repmat(mean(data_array(:,5)),length(data_array(:,5)),1) * realSize(1) / LENGTH);
    plot(real_x(1:length_line), data_array(:,5) * realSize(1) / LENGTH);
    %plot(1:1:length(data_array(:,5)),repmat(mean(data_array(:,5)),length(data_array(:,5)),1));
    %plot(1:1:length(data_array(:,5)),repmat(mode(uint8(data_array(:,5))),length(data_array(:,5)),1),'g');
    plot(real_x(1:length_line),repmat(mean(data_array(:,5)),length(data_array(:,5)),1) * realSize(1) / LENGTH);
    %plot(real_x(1:length_line),repmat(mode(uint8(data_array(:,5))),length(data_array(:,5)),1) * realSize(1) / LENGTH,'g');

%     title(['[Error x]',...
%         ' max:',num2str(max(data_array(:,5)),3),' min:',num2str(min(data_array(:,5)),3),' mean:',num2str(mean(data_array(:,5)),3),...
%         ' mean[m]:',num2str(((mean(data_array(:,5)) * realSize(1)) / LENGTH),3),' max[m]:',num2str(((max(data_array(:,5)) * realSize(1)) / LENGTH),3),...
%         ' dom:',num2str(mode(uint8(data_arr(:,5))),3)...
%         ]);
    title(['[Error x]',...
        ' mean[m]:',num2str(((mean(data_array(:,5)) * realSize(1)) / LENGTH),3),' max[m]:',num2str(((max(data_array(:,5)) * realSize(1)) / LENGTH),3),...
        ' median[m]:',num2str(((median(data_array(:,5)) * realSize(1)) / LENGTH),3)]);
    subplot(3,1,2)
    hold on;
    plot(real_x(1:length_line),data_array(:,6) * realSize(2) / LENGTH_Y);
%     title(['[Error y]',...
%         ' max:',num2str(max(data_array(:,6)),3),' min:',num2str(min(data_array(:,6)),3),' mean:',num2str(mean(data_array(:,6)),3),...
%         ' mean[m]:',num2str(((mean(data_array(:,6)) * realSize(2)) / LENGTH),3),' max[m]:',num2str(((max(data_array(:,6)) * realSize(2)) / LENGTH),3),...
%         ' dom:',num2str(mode(uint8(data_arr(:,6))),3)...
%         ]);
    title(['[Error y]',...
    ' mean[m]:',num2str(((mean(data_array(:,6)) * realSize(2)) / LENGTH_Y),3),' max[m]:',num2str(((max(data_array(:,6)) * realSize(2)) / LENGTH_Y),3),...
    ' median[m]:',num2str(((median(data_array(:,6)) * realSize(2)) / LENGTH),3)]);
    plot(real_x(1:length_line),repmat(mean(data_array(:,6)),length(data_array(:,6)),1) * realSize(2) / LENGTH_Y);
    %plot(real_x(1:length_line),repmat(mode(uint8(data_array(:,6))),length(data_array(:,6)),1) * realSize(2) / LENGTH_Y,'g');

    subplot(3,1,3)
    hold on;
    plot(real_x(1:length_line),data_array(:,7) * realSize(1) / LENGTH);
    title(['[Error dist]',...
        ' max:',num2str((max(data_array(:,7))) * realSize(1) / LENGTH),' mean:',num2str((mean(data_array(:,7))) * realSize(1) / LENGTH,3),...
        ' median[m]:',num2str(((median(data_array(:,7)) * realSize(1)) / LENGTH),3)]);
    plot(real_x(1:length_line),repmat(mean(data_array(:,7)),length(data_array(:,7)),1) * realSize(1) / LENGTH);
    %plot(real_x(1:length_line),repmat(mode(data_array(:,7)),length(data_array(:,7)),1) * realSize(1) / LENGTH,'g');
	legend('x/y/dist[m]','mean [m]','min [m]','Location','best');

    saveas(f5,strcat(dirpath,'/',date,'_error.png'));
end


error_x_real = error_x * realSize(1) / LENGTH;
error_x_meters = data_arr(:,5) * realSize(1) / LENGTH;
error_y_meters = data_arr(:,6) * realSize(2) / LENGTH_Y;
rrmeters = [error_x_meters, error_y_meters];
rrmeters_dist = pdist(rrmeters);
mean_xy_meters = mean(rrmeters_dist);
max_xy_meters = max(rrmeters_dist);
min_xy_meters = min(rrmeters_dist);

x_quant = (quantile(data_array(:,5),[0.50 0.75 0.90 0.95 1])) * realSize(1) / LENGTH;
y_quant = (quantile(data_array(:,6),[0.50 0.75 0.90 0.95 1])) * realSize(1) / LENGTH;
xy_quant = (quantile(rrmeters_dist,[0.50 0.75 0.90 0.95 1]));
iteration_time = median(data_array(:,12));

error_data = ...
    [duration_time,... %1
    min(data_array(:,5)),...
    (min(data_array(:,6))),... %3
    max(data_array(:,5)),...
    (max(data_array(:,6))),... %5
    mean(data_array(:,5)),...
    (mean(data_array(:,7))),... %7
    double(mode(uint8(data_arr(:,5)))),...
    double((mode(uint8(data_arr(:,6))))),... %9
    dx_max,...
    dy_max,... %11
    SIGMA_X,...
    SIGMA_Y,... %13
    move_shift,...
    G_THR,... %15
    RSSI_range,...
    use_magnet,... %17
    start_from,...
    simulate_person_stopped,... %19
    w_upweig_method,...
    N,...
    noise,... %21
    scenario,...
    data_type,...
    adjust_rss_range_enable,... %24
    XMAX,... 
    YMAX,... %26
    use_track_offset,... %27
    ((mean(data_array(:,5)) * realSize(1)) / LENGTH),... %29
    ((max(data_array(:,5)) * realSize(1)) / LENGTH),... %30
    ((mean(data_array(:,6)) * realSize(2)) / LENGTH_Y),... %31
    ((max(data_array(:,6)) * realSize(2)) / LENGTH_Y),... %32
    (mean_xy_meters),... %33 error_xy
    (max_xy_meters),... %33 error_xy
    (min_xy_meters),... %33 error_xy
    x_quant(1),...
    x_quant(2),...%35
    x_quant(3),...
    x_quant(4),...
    x_quant(5),... %38
    y_quant(1),...
    y_quant(2),...%35
    y_quant(3),...
    y_quant(4),...
    y_quant(5),... %38
    xy_quant(1),...
    xy_quant(2),...%35
    xy_quant(3),...
    xy_quant(4),...
    xy_quant(5),...
    iteration_time]; 

    fmt = strcat('%5.3f;',... %1
    '%5.3f;',...
    '%5.3f;',... %3
    '%5.3f;',...
    '%5.3f;',... %5
    '%5.3f;',...
    '%5.3f;',... %7
    '%5.3f;',...
    '%5.3f;',... %9
    '%5.3f;',...
    '%5.3f;',... %11
    '%5.3f;',...
    '%5.3f;',... %13
    '%5.3f;',...
    '%5.3f;',... %15
    '%5.3f;',...
    '%5.3f;',... %17
    '%5.3f;',...
    '%5.3f;',... %19
    '%5.3f;',...
    '%5.3f;',... %21
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',... %24
    '%5.3f;',...
    '%5.3f;',... %26
    '%5.3f;',...
    '%5.3f;',... %28
    '%5.3f;',...
    '%5.3f;',... %30
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',... %34
    '%5.3f;',...
    '%5.3f;',... %36
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',... %36
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',... %36
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;',...
    '%5.3f;\n'); %39

    result = num2str(error_data,fmt);
    
    result = strcat(date,';',result,'\n');
    if (exist(filename, 'file') ~= 2)
        disp(['Adding title']);
        result = strcat('date;',...
            'duration;',...
            'min_x;',...
            'min_y;',...
            'max_x;',...
            'max_y;',...
            'mean_x;',...
            'mean_y;',...
            'dom_x;',...
            'dom_y;',...
            'dx_max;',...
            'dy_max;',...
            'SIGMA_X;',...
            'SIGMA_Y;',...
            'move_shift;',...
            'G_THR;',...
            'RSSI_range;',...
            'use_magnet;',...
            'start_from;',...
            'simulate_person_stopped;',...
            'w_upweig_method;',...
            'N;',...
            'noise;',...
            'scenario;',...
            'data_type;',...
            'adjust_rss_range_enable;',...
            'XMAX;',...
            'YMAX;',...
            'use_track_offset;',...
            'mean_x[m];',...
            'max_x[m];',...
            'mean_y[m];',...
            'max_y[m];',...
            'mean_xy[m];',...
            'max_xy[m];',...
            'min_xy[m];',...
            'quant_x[m]=0.5;',...
            'quant_x[m]=0.75;',...
            'quant_x[m]=0.90;',...
            'quant_x[m]=0.95;',...
            'quant_x[m]=1;',...
            'quant_y[m]=0.5;',...
            'quant_y[m]=0.75;',...
            'quant_y[m]=0.90;',...
            'quant_y[m]=0.95;',...
            'quant_y[m]=1;',...
            'quant_xy[m]=0.5;',...
            'quant_xy[m]=0.75;',...
            'quant_xy[m]=0.90;',...
            'quant_xy[m]=0.95;',...
            'quant_xy[m]=1\n;',...
            'iteration_time\n;',...
            result);
    end

    fileID = fopen(filename,'a');
    fprintf(fileID, result);
    fclose(fileID); 
    
    %if(debug_mode == 1)        
    %    saveas(fig,strcat(dirpath ,date,'.png'));
    %end
    